function strip_html(e){e||(e="");var t=/(<([^>]+)>)/gi;return(e=""+e).replace(t,"")}chrome.runtime.onMessage.addListener(function(e,t){switch(e.do){case"notify":var a=$('<div data-smartysale-notify id="smartysale-notify">                        <a class="smartysale-close" style="background: url('+chrome.extension.getURL("img/close.png")+') no-repeat;" data-close></a>                        <div style="clear:both;"></div>                        <div id="smartysale-logo">                            <img src="'+chrome.extension.getURL("img/logo.png")+'" srcset="'+chrome.extension.getURL("img/logo.png")+" 1x, "+chrome.extension.getURL("img/logo@2x.png")+' 2x" alt="">                        </div>                        <div>                            <div class="smartysale-percent smartysale-redcolor">'+strip_html(e.cashback)+"</div>                            "+chrome.i18n.getMessage("cashbackForOrder")+" <br/>"+strip_html(e.shop)+'                            <div style="margin-top: 10px;" data-id="'+strip_html(e.id)+'" data-get-cashback id="smartysale_notify-button" class="smartysale-button">'+chrome.i18n.getMessage("activateCashback")+"</div>                        </div>                    </div>");$(a).find("[data-close]").on("click",function(){$("[data-smartysale-notify]").remove(),chrome.runtime.sendMessage({do:"close_notify"})}),$(a).find("[data-get-cashback]").on("click",function(){chrome.runtime.sendMessage({do:"cashback",id:$(this).data("id"),url:document.location.href})}),$("body").find("[data-smartysale-notify]").length?$("[data-smartysale-notify]").replaceWith(a):$("body").prepend(a);break;case"remove_notify":$("body").find("[data-smartysale-notify]").remove()}}),$(function(){function e(e,t){for(var a=[e];a.length>0;){var n=a.shift();if("A"===n.tagName){var s=n.href;chrome.runtime.sendMessage({do:"checkCashback",url:s},function(e){if(e.result){var a='<div class="smarty-inject"><img src="'+chrome.extension.getURL("img/inject.png")+'" srcset="'+chrome.extension.getURL("img/inject.png")+" 1x, "+chrome.extension.getURL("img/inject@2x.png")+' 2x" alt=""> '+chrome.i18n.getMessage("cashback")+" "+e.cashback+"</div><br />";n.innerHTML=a+n.innerHTML,t&&$(n).find(".favicon").addClass("smarty-sale-yandex-favicon")}})}else[].slice.call(n.children).forEach(function(e){"SCRIPT"!==e.tagName&&a.push(e)})}}var t={childList:!0,subtree:!0,google:{container:"div#search",elements:"div.rc > h3.r"},yandex:{container:"div.main__center",elements:"li.serp-item  h2.organic__title-wrapper"}},a=/<a.*?>[^<]*<\/a>/;chrome.runtime.sendMessage({do:"checkInject"},function(n){if(!1!==n.result){$("head").append('<link rel="stylesheet" href="'+chrome.extension.getURL('css/inject.min.css" type="text/css" media="screen">'));var s=new MutationObserver(function(r){r.some(function(r){if(r.addedNodes&&r.addedNodes.length>0){for(var c=r.target.querySelector(t[n.inject].container),o=r.target.querySelectorAll(t[n.inject].elements),d=0;d<o.length;d++){var l=o[d];l&&(s.disconnect(),i.observe(c,t),a.test(l.innerHTML)&&e(l,"yandex"===n.inject))}return!0}})}),i=new MutationObserver(function(s){s.forEach(function(s){s.addedNodes&&[].slice.call(s.addedNodes).forEach(function(i){for(var r=s.target.querySelectorAll(t[n.inject].elements),c=0;c<r.length;c++){var o=r[c];o&&a.test(i.outerHTML)&&e(o,"yandex"===n.inject)}})})});s.observe(document.body,t)}})});